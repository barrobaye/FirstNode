datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  role      Role     @default(CLIENT)
  clientId  Int      @unique
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Client {
  id        Int      @id @default(autoincrement())
  nom       String
  prenom    String
  telephone String   @unique
  user      User?    
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Article {
  id             Int            @id @default(autoincrement())
  libelle        String         
  prix           Float
  quantiteStock  Int
  dettes         Detail[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model Detail {
  dette       Dette        @relation(fields: [detteId], references: [id])
  detteId     Int
  article     Article      @relation(fields: [articleId], references: [id])
  articleId   Int
  prixVente   Float
  qteVente    Float
  createdAt   DateTime       @default(now())
  @@id ([detteId, articleId])
}

model Dette {
  id             Int            @id @default(autoincrement())
  clientId       Int
  date           DateTime
  montantDue     Float
  montantVerser  Float
  articles       Detail[]
  paiements      Paiement[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  @@index([clientId], map: "Dette_clientId_fkey")
}

model Paiement {
  id        Int      @id @default(autoincrement())
  detteId   Int
  dette     Dette    @relation(fields: [detteId], references: [id], onDelete: Cascade)
  montant   Float
  date      DateTime
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

enum Role {
  CLIENT
  ADMIN
  BOUTIQUIER
}
